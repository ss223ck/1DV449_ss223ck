"use strict";function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:59.329333,lng:18.068633},zoom:8});var e=new XMLHttpRequest,t="http://api.sr.se/api/v2/traffic/messages?format=json&size=100",a=Math.abs(new Date-new Date(localStorage.timeOfLastCall));a/=1e3,a/=60,(null==localStorage.timeOfLastCall||a>5)&&(e.onreadystatechange=function(){4==e.readyState&&200==e.status&&(localStorage.messages=e.responseText)},e.open("GET",t,!0),e.send(),localStorage.timeOfLastCall=new Date),null!=localStorage.messages?renderMarkers():alert("sidan kunde inte ladda in resurser, testa att ladda om sidan!")}function renderMarkers(){var e=new google.maps.InfoWindow({content:""}),t=JSON.parse(localStorage.messages);t.messages.sort(function(e,t){return e.createddate>t.createddate?-1:e.createddate<t.createddate?1:0});var a=0;t.messages.forEach(function(t){a++;var n,i,s=new Date(parseInt(t.createddate.replace("/Date(",""))),o=s.toDateString("sv-SE"),c=new google.maps.Marker({position:{lat:t.latitude,lng:t.longitude},map:map,title:t.title}),l=document.getElementById("trafficMessages"),d=document.createElement("div"),r=document.createElement("p");switch(d.setAttribute("id","messageDiv"+a),t.category){case 0:n="Vägtrafik",document.getElementById("roadTraffic").addEventListener("click",function(){c.visible?(d.className="hidden",c.setVisible(!1)):(d.className="trafficMessageDiv",c.setVisible(!0))});break;case 1:n="Kollektivtrafik",document.getElementById("collectivTraffic").addEventListener("click",function(){c.visible?(d.className="hidden",c.setVisible(!1)):(d.className="trafficMessageDiv",c.setVisible(!0))});break;case 2:n="Planerad störning",document.getElementById("PlanedDisturbance").addEventListener("click",function(){c.visible?(d.className="hidden",c.setVisible(!1)):(d.className="trafficMessageDiv",c.setVisible(!0))});break;case 3:n="Övrigt",document.getElementById("other").addEventListener("click",function(){c.visible?(d.className="hidden",c.setVisible(!1)):(d.className="trafficMessageDiv",c.setVisible(!0))})}switch(t.priority){case 1:i="Mycket allvarlig händelse";break;case 2:i="Stor händelse";break;case 3:i="Störning";break;case 4:i="Information";break;case 5:i="Mindre störning"}var m='<div id="content"><div id="siteNotice"></div><h1 id="firstHeading" class="firstHeading">'+t.title+'</h1><div id="bodyContent"><p>'+t.exactlocation+"</p><p>"+o+"</p><p>"+n+"</p><p>"+i+"</p><p>"+t.subcategory+"</p></div></div>";c.addListener("click",function(){e.close(),e=new google.maps.InfoWindow({content:""}),e.content=m,e.open(map,c)}),d.className="trafficMessageDiv",r.innerHTML=t.title+" "+o,d.appendChild(r),l.appendChild(d),d.addEventListener("click",function(){e.close(),e=new google.maps.InfoWindow({content:""}),e.content=m,e.open(map,c)})})}function openInfoWindow(e,t){infowindow.close(),infowindow=new google.maps.InfoWindow({content:""}),infowindow.content=e,infowindow.open(map,t)}var map;